#!/bin/bash

export APPROOT=${1-.}
export APPUSER=${2-$USER}
export APPHOME=${3-$HOME}

function topic {
  echo ""
  echo ">> ${@}"
}

function run {
  echo "> Run: ${@}"
  $@
}

topic "Update the apt cache"
run sudo apt-get update

topic "Install node and npm"
run sudo DEBIAN_FRONTEND=noninteractive apt-get install --assume-yes nodejs npm
run sudo update-alternatives --install /usr/bin/node node /usr/bin/nodejs 1

topic "Instal ruby and rubygem"
run sudo apt-get install --assume-yes ruby

topic "Install foreman gem"
run sudo gem install foreman

topic "Install npm dependencies"
cd $APPROOT && run npm install --silent
sh -c 'echo "PATH=$PATH:'$APPROOT'/node_modules/.bin" >> '$APPHOME'/.profile'
